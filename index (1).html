<!DOCTYPE html><html lang="ht">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Echanj Plus ‚Äî App</title>
  <meta name="theme-color" content="#16a34a" />
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    :root{
      --bg: #ffffff;         /* blan */
      --card: #ffffff;       /* blan */
      --text: #0f172a;       /* gri-nwa fonse */
      --muted: #475569;      /* slate-600 */
      --primary: #0d6efd;    /* ble atiran */
      --accent: #0b5ed7;     /* ble fonse */
      --danger: #dc2626;     /* v√®t fonse */
      --danger: #dc2626;
      --radius: 18px;
      --gap: 12px;
      --maxw: 520px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    .app{min-height:100svh;min-height:100dvh;padding:env(safe-area-inset-top) env(safe-area-inset-right) calc(16px + env(safe-area-inset-bottom)) env(safe-area-inset-left);display:grid;place-items:center}
    .full-card{width:min(100%,var(--maxw));background:var(--card);border-radius:20px;padding:20px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 8px 30px rgba(2,6,23,0.06)}
    h1{margin:0;font-size:1.35rem}
    p{margin:6px 0;color:var(--muted)}
    label{font-size:.9rem;color:var(--muted);display:block;margin-top:8px}
    input,select,textarea{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(2,6,23,0.08);margin-top:6px;background:#fff}button.btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 16px;border-radius:14px;border:0;background:var(--primary);color:white;font-weight:800;margin-top:12px;box-shadow:0 6px 16px rgba(22,163,74,.25);cursor:pointer}
button.btn.secondary{background:#f8f9fa;color:var(--text);border:1px solid rgba(2,6,23,0.08);box-shadow:none}
button.btn[disabled]{opacity:.6;cursor:not-allowed}

.row{display:grid;gap:12px}
.cols-2{grid-template-columns:1fr 1fr}
.center{text-align:center}
.muted{color:var(--muted)}
.small{font-size:.85rem}

/* Ekran yo */
[data-screen]{display:none}
[data-screen].active{display:grid;place-items:center;height:100%}

/* Tab anba a (nav) */
nav.toolbar{position:fixed;inset:auto 0 0 0;background:transparent;padding:10px;display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.tab{background:var(--card);border-radius:14px;padding:10px;border:1px solid rgba(0,0,0,0.06);text-align:center;font-weight:800}
.tab.active{background:var(--primary);color:white}

/* Auth */
.auth-card{width:100%;max-width:420px;height:100%;display:flex;flex-direction:column;justify-content:center}
.auth-forms{display:grid;gap:12px}

/* Toast & overlay */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:90px;background:#052018;color:white;padding:10px 14px;border-radius:10px;display:none;z-index:10}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.05);display:none;place-items:center;z-index:9}
.spinner{width:40px;height:40px;border-radius:50%;border:4px solid #e5e7eb;border-top-color:var(--primary);animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Badges */
.badge{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid rgba(0,0,0,0.08);background:#fff}
.code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace}
  /* Bouton Google spesifik pou blan + ble */
#btn-google{background:#ffffff;color:#0d6efd;border:2px solid #0d6efd}
#btn-google:hover{background:#0d6efd;color:#ffffff}

  </style>
</head>
<body>
  <div id="app" class="app"><!-- AUTH (obligatwa, full ekran) -->
<section id="screen-auth" class="active" data-screen>
  <div class="full-card auth-card center">
    <h1>Echanj Plus</h1>
    <p class="muted center">Konekte oswa kreye kont pou kontinye.</p>
    <div class="auth-forms">
      <div id="login-form">
        <label>Im√®l</label>
        <input id="login-email" type="email" autocomplete="email" placeholder="email@exemple.com" />
        <label>Modpas</label>
        <input id="login-pass" type="password" autocomplete="current-password" placeholder="Modpas" />
        <button class="btn" id="btn-login">Konekte</button>
        <button class="btn secondary" onclick="show('signup')">Pa gen kont? Enskri</button>
        <button class="btn" id="btn-google" style="margin-top:6px" onclick="doGoogle()">üîê Konekte ak Google</button>
      </div>
      <div id="signup-form" style="display:none">
        <label>Im√®l</label>
        <input id="su-email" type="email" autocomplete="email" placeholder="email@exemple.com" />
        <label>Modpas</label>
        <input id="su-pass" type="password" autocomplete="new-password" placeholder="8+ karakt√®" />
        <label>Non</label>
        <input id="su-name" autocomplete="name" placeholder="Jean Echanj" />
        <label>Telef√≤n</label>
        <input id="su-phone" autocomplete="tel" placeholder="+509 33 12 34 56" />
        <button class="btn" id="btn-signup">Kreye kont</button>
        <button class="btn secondary" onclick="show('login')">Deja gen kont? Konekte</button>
      </div>
    </div>
    <p class="small muted center">Kontakte: <strong>echanjplus@gmail.com</strong></p>
  </div>
</section>

<!-- DASHBOARD -->
<section id="screen-dashboard" data-screen>
  <div class="full-card">
    <h1>üè† Ak√®y</h1>
    <p class="muted">Byenveni, <span id="user-display" class="badge">itilizat√®</span></p>
    <div class="row cols-2" style="margin-top:10px">
      <button class="btn" onclick="go('send')">üì§ Voye Minit</button>
      <button class="btn" onclick="go('pay')">üí≥ Peman</button>
    </div>
    <div class="row cols-2" style="margin-top:8px">
      <button class="btn secondary" onclick="go('profile')">üë§ Pwofil</button>
      <button class="btn secondary" onclick="go('about')">‚ÑπÔ∏è About</button>
    </div>
    <p class="small muted" style="margin-top:8px">Tout ekran yo plen ekran epi santre pou APK la par√®t pwofesyon√®l.</p>
  </div>
</section>

<!-- SEND MINUTES (ID otomatik, itilizat√® mete s√®lman kantite) -->
<section id="screen-send" data-screen>
  <div class="full-card">
    <h1>üì§ Voye Minit</h1>
    <div class="row">
      <label>Operat√®</label>
      <select id="op" onchange="updateSendUI()">
        <option value="digicel">Digicel</option>
        <option value="natcom">Natcom</option>
      </select>

      <label>Kantite minit</label>
      <input id="minutes" inputmode="numeric" placeholder="Ex: 50" oninput="updateUSSD()" />

      <div class="badge">ID Kliyan: <span id="auto-id" class="code"></span></div>
      <div class="badge">Nimewo Sist√®m: <span id="sys-num" class="code"></span></div>

      <div class="row">
        <label>K√≤d pou konpoze</label>
        <input id="ussd" readonly class="code" />
        <div id="confirm-wrap" class="row">
          <label>K√≤d konfimasyon (Digicel)</label>
          <input id="ussd-confirm" readonly class="code" />
        </div>
      </div>

      <div class="row cols-2">
        <button class="btn" onclick="composeUSSD()">üìû Konpoze</button>
        <button class="btn secondary" onclick="go('dashboard')">‚¨ÖÔ∏è Tounen</button>
      </div>
      <p class="small muted">Remak: Pou Digicel, apre premye k√≤d la, konpoze k√≤d konfimasyon an tou.</p>
    </div>
  </div>
</section>

<!-- PAYMENT (sove nan Firebase + ouvri WhatsApp ak tout detay Send + Payment) -->
<section id="screen-pay" data-screen>
  <div class="full-card">
    <h1>üí≥ Peman</h1>
    <p class="muted small">Ranpli met√≤d peman, peze <strong>Sove / Peye</strong>. Nou sove tranzaksyon an epi n ouvri WhatsApp sist√®m lan ak tout detay yo.</p>

    <div class="row">
      <label>Met√≤d</label>
      <select id="pay-method" onchange="renderPayForm()">
        <option value="moncash">MonCash</option>
        <option value="natcash">NatCash</option>
        <option value="paryajlakay">Paryaj Lakay</option>
        <option value="paryajpam">Paryaj Pam</option>
      </select>

      <div id="pay-forms">
        <div data-payform="moncash">
          <label>Non Kont</label>
          <input id="mc_name" placeholder="Echanj Plus" />
          <label>Nimewo Kont</label>
          <input id="mc_acc" placeholder="+509 44 00 00 00" />
          <label>Montan (Gdes)</label>
          <input id="mc_amt" inputmode="numeric" placeholder="500" />
        </div>
        <div data-payform="natcash" style="display:none">
          <label>Non Kont</label>
          <input id="nc_name" placeholder="Echanj Plus" />
          <label>Nimewo Kont</label>
          <input id="nc_acc" placeholder="+509 42 00 00 00" />
          <label>Montan (Gdes)</label>
          <input id="nc_amt" inputmode="numeric" placeholder="500" />
        </div>
        <div data-payform="paryajlakay" style="display:none">
          <label>Nimewo Kont</label>
          <input id="pl_acc" placeholder="123456" />
          <label>Remak (opsyon√®l)</label>
          <input id="pl_note" />
        </div>
        <div data-payform="paryajpam" style="display:none">
          <label>Nimewo Kont</label>
          <input id="pp_acc" placeholder="654321" />
          <label>Remak (opsyon√®l)</label>
          <input id="pp_note" />
        </div>
      </div>

      <div class="cols-2 row">
        <button class="btn" id="btn-savepay" onclick="savePayment()">‚úÖ Sove / Peye</button>
        <button class="btn secondary" onclick="go('dashboard')">‚¨ÖÔ∏è Tounen</button>
      </div>
    </div>
  </div>
</section>

<!-- PROFILE -->
<section id="screen-profile" data-screen>
  <div class="full-card">
    <h1>üë§ Pwofil</h1>
    <label>Non</label>
    <input id="pf_name" />
    <label>Telef√≤n</label>
    <input id="pf_phone" />
    <label>Im√®l</label>
    <input id="pf_email" disabled />
    <div class="cols-2 row">
      <button class="btn" onclick="saveProfile()">üíæ Sove</button>
      <button class="btn secondary" onclick="go('dashboard')">‚¨ÖÔ∏è Tounen</button>
    </div>
  </div>
</section>

<!-- ABOUT -->
<section id="screen-about" data-screen>
  <div class="full-card center">
    <h1>‚ÑπÔ∏è Sou Echanj Plus</h1>
    <p class="muted small">Platf√≤m pou voye minit ak f√® peman rapid an Ayiti.</p>
    <h3 style="margin-top:6px">Nimewo Sist√®m</h3>
    <p>Digicel: <strong id="num_digicel">+50947111123</strong><br/>Natcom: <strong id="num_natcom">+50932160708</strong></p>
    <p class="small">Im√®l: <strong>echanjplus@gmail.com</strong></p>
    <div class="row cols-2" style="margin-top:8px">
      <button class="btn secondary" onclick="go('dashboard')">‚¨ÖÔ∏è Tounen</button>
      <a class="btn" href="https://facebook.com/echanjplus" target="_blank" rel="noopener">Facebook</a>
    </div>
    <div class="row cols-2">
      <a class="btn" href="https://youtube.com/@echanjplus" target="_blank" rel="noopener">YouTube</a>
      <a class="btn secondary" href="mailto:echanjplus@gmail.com">Im√®l</a>
    </div>
  </div>
</section>

  </div>  <!-- NAV -->  <nav class="toolbar">
    <div class="tab active" data-tab="dashboard" onclick="go('dashboard')">üè†</div>
    <div class="tab" data-tab="send" onclick="go('send')">üì§</div>
    <div class="tab" data-tab="pay" onclick="go('pay')">üí≥</div>
    <div class="tab" data-tab="profile" onclick="go('profile')">üë§</div>
  </nav>  <div id="toast" class="toast"></div>
  <div id="overlay" class="overlay"><div class="spinner"></div></div>  <script>
    /**********************
      KONFIGIRASYON
    ***********************/
    const firebaseConfig = {
      apiKey: "AIzaSyB1VTPakleoggsbLdpm_HS7nSb3A7A99Qw",
      authDomain: "echanj-plus-778cd.firebaseapp.com",
      databaseURL: "https://echanj-plus-778cd-default-rtdb.firebaseio.com",
      projectId: "echanj-plus-778cd",
      storageBucket: "echanj-plus-778cd.firebasestorage.app",
      messagingSenderId: "111144762929",
      appId: "1:111144762929:web:e64ce9a6da65781c289f10",
      measurementId: "G-J1BQRF32ZW"
    };

    const SYSTEM = {
      digicel: '+50947111123',
      natcom: '+50932160708',
      email: 'echanjplus@gmail.com'
    };
    const WHATSAPP_TARGET = '50947111123'; // Whatsapp sist√®m lan

    // Inisyalize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    /* UTIL */
    function toast(msg){const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2300)}
    function overlay(on){document.getElementById('overlay').style.display = on? 'grid':'none'}
    function parseNum(v){return Math.max(0, Number(String(v).replace(/[^0-9.]/g,''))||0)}

    /* NAV */
    function go(name){
      document.querySelectorAll('[data-screen]').forEach(v=>v.classList.remove('active'));
      document.querySelector(`#screen-${name}`).classList.add('active');
      document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active', t.dataset.tab===name));
      window.scrollTo({top:0,behavior:'instant'});
    }

    /* AUTH */
    function show(mode){
      document.getElementById('login-form').style.display = (mode==='login')? 'block':'none';
      document.getElementById('signup-form').style.display = (mode==='signup')? 'block':'none';
    }

    async function doGoogle(){
      overlay(true);
      try{
        const cred = await auth.signInWithPopup(googleProvider);
        const { user } = cred;
        const uref = db.ref('users/'+user.uid);
        const snap = await uref.once('value');
        if(!snap.exists()){
          await uref.set({
            name: user.displayName || '',
            phone: user.phoneNumber || '',
            email: user.email || '',
            provider: 'google',
            created: Date.now()
          });
        }
        toast('Konekte ak Google');
      }catch(e){ toast(e.message); }
      overlay(false);
    }

    async function doSignup(){
      const email = document.getElementById('su-email').value.trim();
      const pass = document.getElementById('su-pass').value;
      const name = document.getElementById('su-name').value.trim();
      const phone = document.getElementById('su-phone').value.trim();
      if(!email||!pass||!name) return toast('Ranpli tout chan obligatwa');
      overlay(true);
      try{
        const userCred = await auth.createUserWithEmailAndPassword(email, pass);
        const uid = userCred.user.uid;
        await db.ref('users/'+uid).set({name,phone,email,created:Date.now(),provider:'password'});
        toast('Kont kreye av√®k siks√®');
      }catch(e){toast(e.message)}
      overlay(false);
    }

    async function doLogin(){
      const email = document.getElementById('login-email').value.trim();
      const pass = document.getElementById('login-pass').value;
      if(!email||!pass) return toast('Antre im√®l ak modpas');
      overlay(true);
      try{ await auth.signInWithEmailAndPassword(email, pass); }
      catch(e){ toast(e.message); }
      overlay(false);
    }
(mode){
      document.getElementById('login-form').style.display = (mode==='login')? 'block':'none';
      document.getElementById('signup-form').style.display = (mode==='signup')? 'block':'none';
    }

    async function doSignup(){
      const email = document.getElementById('su-email').value.trim();
      const pass = document.getElementById('su-pass').value;
      const name = document.getElementById('su-name').value.trim();
      const phone = document.getElementById('su-phone').value.trim();
      if(!email||!pass||!name) return toast('Ranpli tout chan obligatwa');
      overlay(true);
      try{
        const userCred = await auth.createUserWithEmailAndPassword(email, pass);
        const uid = userCred.user.uid;
        await db.ref('users/'+uid).set({name,phone,email,created:Date.now()});
        toast('Kont kreye av√®k siks√®');
      }catch(e){toast(e.message)}
      overlay(false);
    }

    async function doLogin(){
      const email = document.getElementById('login-email').value.trim();
      const pass = document.getElementById('login-pass').value;
      if(!email||!pass) return toast('Antre im√®l ak modpas');
      overlay(true);
      try{ await auth.signInWithEmailAndPassword(email, pass); }
      catch(e){ toast(e.message); }
      overlay(false);
    }

    document.addEventListener('DOMContentLoaded',()=>{
      document.getElementById('btn-login').addEventListener('click', doLogin);
      document.getElementById('btn-signup').addEventListener('click', doSignup);
      const gbtn=document.getElementById('btn-google'); if(gbtn) gbtn.addEventListener('click', doGoogle);
    });

    // Google Auth Provider
    const googleProvider = new firebase.auth.GoogleAuthProvider();

    auth.onAuthStateChanged(async user=>{
      if(user){
        document.querySelectorAll('[data-screen]').forEach(s=>s.classList.remove('active'));
        document.getElementById('screen-dashboard').classList.add('active');
        const uid = user.uid;
        const snap = await db.ref('users/'+uid).once('value');
        const data = snap.val() || {};
        document.getElementById('user-display').textContent = data.name || user.email || 'Itilizat√®';
        document.getElementById('pf_name').value = data.name || '';
        document.getElementById('pf_phone').value = data.phone || '';
        document.getElementById('pf_email').value = user.email || '';
        updateSendUI();
      } else {
        document.querySelectorAll('[data-screen]').forEach(s=>s.classList.remove('active'));
        document.getElementById('screen-auth').classList.add('active');
      }
    });

    /* SEND MINUTES */
    function updateSendUI(){
      const op = document.getElementById('op').value;
      const sys = (op==='natcom')? SYSTEM.natcom : SYSTEM.digicel;
      const id = (op==='natcom')? '32160708' : ('509'+SYSTEM.digicel.replace(/\D/g,'').slice(-8));
      document.getElementById('sys-num').textContent = sys;
      document.getElementById('auto-id').textContent = id;
      // Digicel gen k√≤d konfimasyon, Natcom pa bezwen
      document.getElementById('confirm-wrap').style.display = (op==='digicel')? 'grid':'none';
      updateUSSD();
    }

    function updateUSSD(){
      const op = document.getElementById('op').value;
      const mins = parseNum(document.getElementById('minutes').value);
      let ussd = '';
      let confirm = '';
      if(op==='digicel'){
        // *128*50947111123*{mins}#  puis *128*1#
        const sys = SYSTEM.digicel.replace(/\D/g,'');
        ussd = `*128*509${sys.slice(-8)}*${mins}#`;
        confirm = `*128*1#`;
      }else{
        // Natcom: *123*88888888*32160708*{mins}#
        ussd = `*123*88888888*32160708*${mins}#`;
      }
      document.getElementById('ussd').value = ussd;
      document.getElementById('ussd-confirm').value = confirm;
    }

    function composeUSSD(){
      const op = document.getElementById('op').value;
      const base = document.getElementById('ussd').value.trim();
      if(!base || base.indexOf('#')===-1) return toast('Antre kantite minit la');
      const encoded = base.replace(/#/g, encodeURIComponent('#'));
      window.location.href = 'tel:'+encoded;
      // Si se digicel, itilizat√® a ap ka konpoze k√≤d konfimasyon an apre
    }

    /* PAYMENT */
    function renderPayForm(){
      const key = document.getElementById('pay-method').value;
      document.querySelectorAll('[data-payform]').forEach(f=>f.style.display='none');
      const el = document.querySelector('[data-payform="'+key+'"]'); if(el) el.style.display='block';
    }
    renderPayForm();

    async function savePayment(){
      const user = auth.currentUser; if(!user) return toast('Ou dwe konekte pou peye');
      const method = document.getElementById('pay-method
