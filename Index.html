<!DOCTYPE html>
<html lang="hc">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echanj Plus - S√®vis rapid</title>
    <style>
        /* CSS YO TOUT LA */
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; display: flex; justify-content: center; padding: 20px; }
        .container { width: 100%; max-width: 400px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
        .logo { width: 150px; margin-bottom: 20px; }
        input { width: 90%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { width: 95%; padding: 12px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .nav-bar { display: flex; gap: 5px; margin-bottom: 20px; }
        .nav-bar button { background: #007bff; font-size: 14px; padding: 8px; }
        .balance-card { background: #333; color: gold; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .card { height: 80px; display: flex; align-items: center; justify-content: center; margin: 10px 0; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 20px; text-transform: uppercase; }
        .digicel { background-color: #ff0000; color: white; border: 4px solid white; }
        .natcom { background-color: #ff8c00; color: white; border: 4px solid white; }
        .radio-group { display: flex; justify-content: space-around; margin: 15px 0; background: #eee; padding: 10px; border-radius: 8px; }
        .modal { display: none; padding: 20px; border: 2px solid #28a745; margin-top: 10px; background: #fff; border-radius: 10px; }
        #calc-preview { font-weight: bold; color: #28a745; margin: 10px 0; }
        a { color: #007bff; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <img src="https://i.postimg.cc/vTtVtB8P/20260205-163353-removebg-preview.png" alt="Logo" class="logo">

        <div id="auth-section">
            <div id="login-form">
                <h2>Konekte</h2>
                <input type="email" id="login-email" placeholder="Email ou">
                <input type="password" id="login-pass" placeholder="Modpas ou">
                <button id="btn-login">Konekte</button>
                <p>Poko gen kont? <a href="#" id="go-to-reg">Enskri la</a></p>
            </div>

            <div id="register-form" style="display:none;">
                <h2>Enskri</h2>
                <input type="text" id="reg-name" placeholder="Non konpl√® ou">
                <input type="tel" id="reg-phone" placeholder="Nimewo telef√≤n ou">
                <input type="email" id="reg-email" placeholder="Email ou">
                <input type="password" id="reg-pass" placeholder="Modpas ou">
                <div class="radio-group">
                    <label><input type="radio" name="seks" value="Fi"> Fi</label>
                    <label><input type="radio" name="seks" value="Gason"> Gason</label>
                </div>
                <button id="btn-register">Enskri</button>
                <p>Gen yon kont deja? <a href="#" id="go-to-login">Konekte la</a></p>
            </div>
        </div>

        <div id="main-app" style="display:none;">
            <div class="balance-card">
                <h3>Balans: <span id="user-balance">0.00</span> Gdes</h3>
            </div>

            <nav class="nav-bar">
                <button id="nav-echanj">Echanj</button>
                <button id="nav-retre">Retr√®</button>
                <button id="btn-logout" style="background:#dc3545;">Soti</button>
            </nav>

            <div id="echanj-section">
                <div class="card digicel" id="card-digicel">Digicel</div>
                <div class="card natcom" id="card-natcom">Natcom</div>

                <div id="exchange-modal" class="modal">
                    <h3 id="modal-title">Vann Minit</h3>
                    <input type="number" id="amount-to-sell" placeholder="Kantite (Gdes)">
                    <p id="calc-preview">W ap resevwa: 0 Gdes</p>
                    <button id="btn-confirm-exchange">Echanje</button>
                    <button id="btn-close-modal" style="background:#6c757d;">Anile</button>
                </div>
            </div>

            <div id="retre-section" style="display:none;">
                <h3>Retr√®</h3>
                <div class="radio-group" style="flex-direction:column; align-items:flex-start;">
                    <label><input type="radio" name="metod" value="MonCash"> MonCash</label>
                    <label><input type="radio" name="metod" value="NatCash"> NatCash</label>
                    <label><input type="radio" name="metod" value="Paryaj Lakay"> Paryaj Lakay</label>
                    <label><input type="radio" name="metod" value="Paryaj Pam"> Paryaj Pam</label>
                </div>
                <input type="number" id="withdraw-amount" placeholder="Kantite">
                <input type="text" id="withdraw-name" placeholder="Non Konpl√®">
                <button id="btn-process-withdraw">F√® Retr√®</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB1VTPakleoggsbLdpm_HS7nSb3A7A99Qw",
            authDomain: "echanj-plus-778cd.firebaseapp.com",
            databaseURL: "https://echanj-plus-778cd-default-rtdb.firebaseio.com",
            projectId: "echanj-plus-778cd",
            storageBucket: "echanj-plus-778cd.firebasestorage.app",
            messagingSenderId: "111144762929",
            appId: "1:111144762929:web:e64ce9a6da65781c289f10"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // UI Toggles
        const show = (id) => document.getElementById(id).style.display = 'block';
        const hide = (id) => document.getElementById(id).style.display = 'none';

        document.getElementById('go-to-reg').onclick = () => { hide('login-form'); show('register-form'); };
        document.getElementById('go-to-login').onclick = () => { hide('register-form'); show('login-form'); };

        // Enskripsyon
        document.getElementById('btn-register').onclick = async () => {
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            const name = document.getElementById('reg-name').value;
            const phone = document.getElementById('reg-phone').value;
            const seks = document.querySelector('input[name="seks"]:checked')?.value;

            if(!email || !pass || !name || !seks) return alert("Ranpli tout bwat yo");

            try {
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                await set(ref(db, 'users/' + res.user.uid), {
                    fullname: name, phone: phone, email: email, gender: seks, balance: 0
                });
                alert("Bwavo! Enskri avek siks√®.");
            } catch (e) { alert("Er√®: " + e.message); }
        };

        // Koneksyon
        document.getElementById('btn-login').onclick = async () => {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
                alert("Bienvenue sur Echanj plus!");
            } catch (e) { alert("Email oswa Modpas pa bon"); }
        };

        // Koute eta itilizat√® a
        onAuthStateChanged(auth, (user) => {
            if (user) {
                hide('auth-section'); show('main-app');
                onValue(ref(db, 'users/' + user.uid + '/balance'), (snap) => {
                    document.getElementById('user-balance').innerText = (snap.val() || 0).toFixed(2);
                });
            } else {
                show('auth-section'); hide('main-app');
            }
        });

        // Echanj Lojik
        let currentProv = '';
        const openModal = (p) => { 
            currentProv = p; 
            show('exchange-modal'); 
            document.getElementById('modal-title').innerText = "Vann Minit " + p;
        };
        
        document.getElementById('card-digicel').onclick = () => openModal('digicel');
        document.getElementById('card-natcom').onclick = () => openModal('natcom');
        document.getElementById('btn-close-modal').onclick = () => hide('exchange-modal');

        document.getElementById('amount-to-sell').oninput = (e) => {
            const val = parseFloat(e.target.value) || 0;
            const net = val - (val * 0.165);
            document.getElementById('calc-preview').innerText = `W ap resevwa: ${net.toFixed(2)} Gdes`;
        };

        document.getElementById('btn-confirm-exchange').onclick = async () => {
            const qty = parseFloat(document.getElementById('amount-to-sell').value);
            if(currentProv === 'digicel' && (qty < 100 || qty > 1000)) return alert("Min 100, Max 1000");
            if(currentProv === 'natcom' && (qty < 100 || qty > 500)) return alert("Min 100, Max 500");

            const msg = currentProv === 'digicel' ? "Voye 1er k√≤d la, apre konpoze *128*1# pou konfime. Kontinye?" : "Vle vann minit Natcom ou?";
            if(confirm(msg)) {
                const net = qty - (qty * 0.165);
                const user = auth.currentUser;
                const snap = await get(ref(db, `users/${user.uid}/balance`));
                await update(ref(db, `users/${user.uid}`), { balance: (snap.val() || 0) + net });
                
                let dial = currentProv === 'digicel' ? `tel:*128*50947111123*${qty}%23` : `tel:*123*88888888*32160708*${qty}%23`;
                window.location.href = dial;
            }
        };

        // Retr√® Lojik
        document.getElementById('btn-process-withdraw').onclick = async () => {
            const amt = parseFloat(document.getElementById('withdraw-amount').value);
            const met = document.querySelector('input[name="metod"]:checked')?.value;
            const name = document.getElementById('withdraw-name').value;
            const user = auth.currentUser;

            const snap = await get(ref(db, `users/${user.uid}/balance`));
            const bal = snap.val() || 0;

            if(amt > bal) return alert("Balans ou tw√≤ piti");
            if(amt < 83.5) return alert("Minim√≤m se 83.5 Gdes");

            await update(ref(db, `users/${user.uid}`), { balance: bal - amt });
            const waMsg = `üí∏ *RETR√à ECHANJ PLUS*%0Aüë§ Non: ${name}%0Aüí∞ Kantite: ${amt}G%0Aüè¶ Met√≤d: ${met}`;
            window.location.href = `https://wa.me/50947111123?text=${waMsg}`;
        };

        document.getElementById('nav-echanj').onclick = () => { show('echanj-section'); hide('retre-section'); };
        document.getElementById('nav-retre').onclick = () => { hide('echanj-section'); show('retre-section'); };
        document.getElementById('btn-logout').onclick = () => signOut(auth);

    </script>
</body>
                </html>
    
