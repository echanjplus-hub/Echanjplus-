<!DOCTYPE html>
<html lang="ht">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Echanj Plus</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; }
html, body { width:100%; height:100%; font-family:'Segoe UI',sans-serif; background:#fff; color:#111; }
body { display:flex; flex-direction:column; }
header { display:flex; justify-content:space-between; align-items:center; padding:1rem; background:#222; color:#ffc107; flex-shrink:0; }
header .brand h1 { font-size:1.6rem; }
header .brand p { font-size:0.9rem; color:#ccc; }
.nav-buttons { display:flex; gap:0.3rem; flex-wrap:wrap; }
.btn { background:#ffc107; color:#000; padding:0.6rem 1rem; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:0.2s; font-size:0.9rem; }
.btn:hover { background:#e0a800; }
.user-area { display:flex; gap:10px; align-items:center; }
.user-badge { background:rgba(255,193,7,0.2); padding:4px 8px; border-radius:20px; font-size:0.8rem; }
section { display:none; flex-direction:column; padding:1rem; margin:0.5rem auto; background:#f5f5f5; border-radius:12px; width:95%; max-width:500px; flex-grow:1; overflow:auto; box-shadow:0 6px 20px rgba(0,0,0,0.2); }
section.active { display:flex; }
input, select, textarea { width:100%; padding:0.7rem; margin:0.3rem 0; border-radius:10px; border:1px solid #ccc; font-size:0.9rem; }
.inline-group { display:flex; gap:0.3rem; flex-wrap:wrap; margin-top:0.3rem; }
.auth-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.95); display:flex; align-items:center; justify-content:center; z-index:50; }
.auth-card { background:#222; padding:2rem; border-radius:12px; width:90%; max-width:400px; display:flex; flex-direction:column; gap:12px; color:#ffc107; }
.message { min-height:1.2em; font-size:0.9rem; }
.sidebar { position:fixed; top:0; left:-240px; width:240px; height:100%; background:#333; padding:1rem; display:flex; flex-direction:column; gap:12px; transition:0.3s; z-index:30; }
.sidebar.active { left:0; }
.hamburger { font-size:1.5rem; cursor:pointer; }
.toast { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#ffc107; color:#000; padding:0.8rem 1.2rem; border-radius:12px; display:none; z-index:100; font-weight:600; }
.loader { border:4px solid #f3f3f3; border-top:4px solid #ffc107; border-radius:50%; width:36px; height:36px; animation:spin 1s linear infinite; margin:auto; display:none; }
.social-links { display:flex; gap:10px; justify-content:center; margin-top:10px; }
.social-links a { color:#ffc107; text-decoration:none; font-weight:600; }
@keyframes spin { 0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }
@media(max-width:600px){
  header .nav-buttons { display:none; }
  section { width:95%; padding:0.7rem; }
  .btn { padding:0.5rem 0.8rem; font-size:0.8rem; }
}
</style>
</head>
<body>

<header>
  <div class="brand"><h1>Echanj Plus</h1><p>Vit • Senp • Serye</p></div>
  <div class="nav-buttons">
    <button class="btn" onclick="requireAuth(()=>showSection('minit'))">Voye Minit</button>
    <button class="btn" onclick="requireAuth(()=>showSection('peyman'))">Peyman</button>
    <button class="btn" onclick="requireAuth(()=>showSection('profil'))">Profil</button>
    <button class="btn" onclick="requireAuth(()=>showSection('feedback'))">Feedback</button>
    <button class="btn" onclick="requireAuth(()=>showSection('rezerve'))">Rezève</button>
  </div>
  <div class="hamburger" onclick="toggleSidebar()">☰</div>
  <div class="user-area" id="userArea" style="display:none;">
    <div class="user-badge" id="userEmailDisplay">...</div>
    <button class="btn" onclick="logout()">Dekonekte</button>
  </div>
</header>

<div class="sidebar" id="sidebar">
  <button class="btn" onclick="showSection('minit')">Voye Minit</button>
  <button class="btn" onclick="showSection('peyman')">Peyman</button>
  <button class="btn" onclick="showSection('profil')">Profil</button>
  <button class="btn" onclick="showSection('feedback')">Feedback</button>
  <button class="btn" onclick="showSection('rezerve')">Rezève</button>
</div>

<section id="minit">
  <h2>Voye Minit</h2>
  <input type="number" id="minitVal" placeholder="Eg: 100" min="100">
  <div class="inline-group">
    <button class="btn" onclick="requireAuth(()=>voyeUSSD('digicel'))">Digicel</button>
    <button class="btn" onclick="requireAuth(()=>voyeUSSD('natcom'))">Natcom</button>
  </div>
</section>

<section id="peyman">
  <h2>Peyman</h2>
  <select id="service">
    <option value="MonCash">MonCash</option>
    <option value="NatCash">NatCash</option>
  </select>
  <input type="text" id="non" placeholder="Non Kont">
  <input type="text" id="numero" placeholder="Nimewo Kont">
  <input type="number" id="montan" placeholder="Montan (min 100)" min="100">
  <button class="btn" onclick="requireAuth(soumetPeyman)">Voye</button>
</section>

<section id="profil">
  <h2>Profil</h2>
  <input type="text" id="profilNom" placeholder="Non">
  <input type="text" id="profilTel" placeholder="Nimewo Telefòn">
  <select id="profilSexe">
    <option value="">Sèks</option>
    <option value="M">Gason</option>
    <option value="F">Fi</option>
  </select>
  <button class="btn" onclick="saveProfil()">Sove Profil</button>
</section>

<section id="feedback">
  <h2>Feedback</h2>
  <textarea id="feedbackText" placeholder="Ekri komantè w..."></textarea>
  <div class="inline-group">
    <button class="btn" onclick="submitFeedback(1)">1⭐</button>
    <button class="btn" onclick="submitFeedback(2)">2⭐</button>
    <button class="btn" onclick="submitFeedback(3)">3⭐</button>
    <button class="btn" onclick="submitFeedback(4)">4⭐</button>
    <button class="btn" onclick="submitFeedback(5)">5⭐</button>
  </div>
</section>

<section id="rezerve">
  <h2>Rezève</h2>
  <h3>Tout Tranzaksyon</h3>
  <div id="transactionList" style="max-height:200px; overflow:auto; border:1px solid #ccc; padding:8px; border-radius:8px;">Chaje tranzaksyon...</div>

  <h3>Tout Feedback</h3>
  <div id="allFeedback" style="max-height:200px; overflow:auto; border:1px solid #ccc; padding:8px; border-radius:8px;">Chaje feedback...</div>
</section>

<div class="auth-overlay" id="authOverlay">
  <div class="auth-card">
    <h2>Konekte oswa Enskri</h2>
    <input type="email" id="email" placeholder="Imèl ou">
    <input type="password" id="password" placeholder="Modpas ou">
    <div class="inline-group">
      <button class="btn" onclick="register()">Enskri</button>
      <button class="btn" onclick="login()">Konekte</button>
    </div>
    <div class="message" id="authMsg"></div>
    <div class="loader" id="loader"></div>
    <div class="social-links">
      <a href="https://youtube.com/@echanjplus?si=TmIwm71__vRJiVuP" target="_blank">YouTube</a>
      <a href="https://www.facebook.com/profile.php?id=61578991569093&mibextid=ZbWKwL" target="_blank">Facebook</a>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>

<script>
// Firebase setup
const firebaseConfig = {apiKey:"AIzaSyB1VTPakleoggsbLdpm_HS7nSb3A7A99Qw", authDomain:"echanj-plus-778cd.firebaseapp.com", projectId:"echanj-plus-778cd", storageBucket:"echanj-plus-778cd.appspot.com", messagingSenderId:"111144762929", appId:"1:111144762929:web:e64ce9a6da65781c289f10", databaseURL:"https://echanj-plus-778cd-default-rtdb.firebaseio.com"};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

const authOverlay = document.getElementById('authOverlay');
const loader = document.getElementById('loader');
const toast = document.getElementById('toast');
const sidebar = document.getElementById('sidebar');
const userArea = document.getElementById('userArea');
const userEmailDisplay = document.getElementById('userEmailDisplay');
const authMsg = document.getElementById('authMsg');

function showSection(id){ document.querySelectorAll('section').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); sidebar.classList.remove('active'); }
function toggleSidebar(){ sidebar.classList.toggle('active'); }
let touchStartX=0; document.body.addEventListener('touchstart', e=>{ touchStartX=e.touches[0].clientX; });
document.body.addEventListener('touchend', e=>{ const touchEndX=e.changedTouches[0].clientX; if(touchEndX-touchStartX>50) sidebar.classList.add('active'); if(touchStartX-touchEndX>50) sidebar.classList.remove('active'); });
function showToast(msg){ toast.textContent=msg; toast.style.display='block'; setTimeout(()=>toast.style.display='none',3000); }

function requireAuth(fn){ if(auth.currentUser) fn(); else authOverlay.style.display='flex'; }
function hideAuth(){ authOverlay.style.display='none'; }
function register(){ const email=document.getElementById('email').value.trim(); const password=document.getElementById('password').value.trim(); if(!email||!password){ authMsg.textContent='Ranpli tout chan yo'; authMsg.style.color='red'; return; } loader.style.display='block'; auth.createUserWithEmailAndPassword(email,password).then(()=>{ loader.style.display='none'; showToast('Enskripsyon siksè!'); hideAuth(); }).catch(e=>{ loader.style.display='none'; authMsg.textContent=e.message; authMsg.style.color='red'; }); }
function login(){ const email=document.getElementById('email').value.trim(); const password=document.getElementById('password').value.trim(); if(!email||!password){ authMsg.textContent='Ranpli tout chan yo'; authMsg.style.color='red'; return; } loader.style.display='block'; auth.signInWithEmailAndPassword(email,password).then(()=>{ loader.style.display='none'; showToast('Byenvini!'); hideAuth(); showSection('minit'); }).catch(e=>{ loader.style.display='none'; authMsg.textContent=e.message; authMsg.style.color='red'; }); }
function logout(){ auth.signOut().then(()=>{ userArea.style.display='none'; showSection('minit'); authOverlay.style.display='flex'; }); }

auth.onAuthStateChanged(user=>{ if(user){ userArea.style.display='flex'; userEmailDisplay.textContent=user.email; hideAuth(); showSection('minit'); } else authOverlay.style.display='flex'; });

// Voye minit
function voyeUSSD(type){ const minit=document.getElementById('minitVal').value; if(!minit||minit<100){ showToast('Mete omwen 100'); return; } let ussd=''; if(type==='digicel') ussd=`tel:*128*50947111123*${minit}#`; if(type==='natcom') ussd=`tel:*123*88888888*32160708*${minit}#`; window.location.href=ussd; }

// Peyman
function soumetPeyman(){ const nom=document.getElementById('non').value; const numero=document.getElementById('numero').value; const montan=parseInt(document.getElementById('montan').value); const service=document.getElementById('service').value; if(!nom||!numero||montan<100){ showToast('Ranpli tout chan yo epi mete plis pase 100'); return; } const frais=Math.round(montan*0.175); const kod='EP'+Date.now(); const done={ non:nom, telephone:numero, montan, frais, date:new Date().toLocaleString(), service, code:kod }; db.ref('transactions/'+kod).set(done); const mesaj=`EchanjPlus\nNon:${nom}\nNimewo:${numero}\nMontan:${montan} G\nFrais:${frais} G\nSèvis:${service}\nKod:${kod}`; window.open(`https://wa.me/50947111123?text=${encodeURIComponent(mesaj)}`); showToast('Peyman voye ak siksè!'); document.getElementById('non').value=''; document.getElementById('numero').value=''; document.getElementById('montan').value=''; }

// Profil
function saveProfil(){ const nom=document.getElementById('profilNom').value; const tel=document.getElementById('profilTel').value; const sexe=document.getElementById('profilSexe').value; if(!nom||!tel){ showToast('Ranpli non ak telefòn'); return; } const uid=auth.currentUser.uid; db.ref('users/'+uid).set({ nom, tel, sexe }); showToast('Profil sove!'); }

// Feedback
function submitFeedback(star){ const text=document.getElementById('feedbackText').value; const uid=auth.currentUser.uid; const feedbackId='FB'+Date.now(); db.ref('feedback/'+feedbackId).set({ uid, star, text, date:new Date().toLocaleString() }); showToast('Feedback voye!'); document.getElementById('feedbackText').value=''; }

// Listener otomatik pou tranzaksyon ak feedback
db.ref('transactions').on('value', snapshot=>{
  const data = snapshot.val();
  const list = document.getElementById('transactionList');
  if(!data){ list.innerHTML='Pa gen tranzaksyon'; return; }
  let html='';
  Object.keys(data).reverse().forEach(k=>{
    const t = data[k];
    html+=`<div style="border-bottom:1px solid #ccc; padding:6px 0;"><b>${t.code}</b> - ${t.nom} - ${t.telephone} - ${t.montan}G - ${t.frais}G - ${t.service} - ${t.date}</div>`;
  });
  list.innerHTML=html;
});

db.ref('feedback').on('value', snapshot=>{
  const data = snapshot.val();
  const fbContainer = document.getElementById('allFeedback');
  if(!data){ fbContainer.innerHTML='Pa gen feedback'; return; }
  let html='';
  Object.keys(data).reverse().forEach(k=>{
    const fb = data[k];
    html += `<div style="border-bottom:1px solid #ccc; padding:6px 0;"><b>${fb.star}⭐</b> - ${fb.text}<br><small>${fb.date}</small></div>`;
  });
  fbContainer.innerHTML = html;
});
</script>

</body>
  </html>
