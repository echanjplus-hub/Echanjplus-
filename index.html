<!DOCTYPE html>
<html lang="ht">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Echanj Plus</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <style>
    /* Reset */
    *{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}

    body{
      background:#fff;
      color:#111;
      transition:all 0.3s ease;
      overflow-x:hidden;
    }
    body.dark{background:#111;color:#fff;}

    /* Loader */
    #loader{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#fff;z-index:9999;}
    .spinner{width:50px;height:50px;border:5px solid #ccc;border-top:5px solid #007bff;border-radius:50%;animation:spin 1s linear infinite;}
    @keyframes spin{100%{transform:rotate(360deg);}}

    /* Auth Overlay */
    #auth-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#f9f9f9;display:flex;align-items:center;justify-content:center;z-index:1000;}
    #auth-box{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:350px;box-shadow:0 0 10px rgba(0,0,0,0.2);}
    #auth-box h2{text-align:center;margin-bottom:15px;}
    #auth-box input{width:100%;padding:10px;margin:5px 0;border:1px solid #ccc;border-radius:5px;}
    #auth-box button{width:100%;padding:10px;margin-top:10px;background:#007bff;color:#fff;border:none;border-radius:5px;cursor:pointer;}
    #auth-box p{text-align:center;margin-top:10px;}
    #auth-box a{color:#007bff;cursor:pointer;}

    /* Sidebar */
    #sidebar{position:fixed;top:0;left:-250px;width:250px;height:100%;background:#222;color:#fff;transition:0.3s;padding-top:60px;z-index:999;}
    #sidebar.active{left:0;}
    #sidebar a{display:block;padding:15px;color:#fff;text-decoration:none;}
    #sidebar a:hover{background:#444;}

    /* Topbar */
    #topbar{position:fixed;top:0;left:0;width:100%;height:60px;background:#007bff;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 15px;z-index:998;}
    #menu-btn{font-size:24px;cursor:pointer;}
    #logout-btn{background:transparent;border:none;color:#fff;cursor:pointer;}

    /* Main content */
    #content{margin-top:70px;padding:20px;}
    section{display:none;}
    section.active{display:block;}

    /* Toast */
    #toast{position:fixed;bottom:20px;right:20px;background:#333;color:#fff;padding:10px 20px;border-radius:5px;display:none;z-index:2000;}
  </style>
</head>
<body>
  <!-- Loader -->
  <div id="loader"><div class="spinner"></div></div>

  <!-- Auth Screen -->
  <div id="auth-screen">
    <div id="auth-box">
      <h2 id="auth-title">Login</h2>
      <input type="email" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Password">
      <button id="auth-action">Login</button>
      <p id="toggle-auth">No account? <a id="switch">Sign Up</a></p>
    </div>
  </div>

  <!-- Sidebar -->
  <div id="sidebar">
    <a href="#" data-section="dashboard">üè† Dashboard</a>
    <a href="#" data-section="profile">üë§ Profile</a>
    <a href="#" data-section="minutes">üìû Voye Minit</a>
    <a href="#" data-section="payment">üí≥ Peyman</a>
    <a href="#" data-section="feedback">‚≠ê Feedback</a>
    <a href="#" id="toggle-dark">üåô Dark Mode</a>
  </div>

  <!-- Topbar -->
  <div id="topbar">
    <span id="menu-btn">‚ò∞</span>
    <h3>Echanj Plus</h3>
    <button id="logout-btn">Logout</button>
  </div>

  <!-- Content -->
  <div id="content">
    <section id="dashboard" class="active">
      <h2>Dashboard</h2>
      <p>Byenvini sou Echanj Plus</p>
    </section>

    <section id="profile">
      <h2>Profile</h2>
      <input id="name" placeholder="Non">
      <input id="phone" placeholder="Telef√≤n">
      <select id="gender">
        <option value="">S√®ks</option>
        <option value="male">Gason</option>
        <option value="female">Fi</option>
      </select>
      <button id="save-profile">Save</button>
    </section>

    <section id="minutes">
      <h2>Voye Minit</h2>
      <input type="number" id="amount" placeholder="Antre kantite minit">
      <select id="operator">
        <option value="digicel">Digicel</option>
        <option value="natcom">Natcom</option>
      </select>
      <button id="send-minutes">Voye</button>
      <p id="minutes-result"></p>
    </section>

    <section id="payment">
      <h2>Peyman</h2>
      <select id="pay-method">
        <option value="">Chwazi met√≤d</option>
        <option value="moncash">MonCash</option>
        <option value="natcash">NatCash</option>
      </select>
      <div id="pay-form"></div>
    </section>

    <section id="feedback">
      <h2>Feedback</h2>
      <div id="stars">
        <span data-rate="1">‚≠ê</span>
        <span data-rate="2">‚≠ê</span>
        <span data-rate="3">‚≠ê</span>
        <span data-rate="4">‚≠ê</span>
        <span data-rate="5">‚≠ê</span>
      </div>
      <p id="trust"></p>
    </section>
  </div>

  <!-- Toast -->
  <div id="toast"></div>

  <script>
    /* Firebase Config */
    const firebaseConfig = {
      apiKey: "AIzaSyB1VTPakleoggsbLdpm_HS7nSb3A7A99Qw",
      authDomain: "echanj-plus-778cd.firebaseapp.com",
      databaseURL: "https://echanj-plus-778cd-default-rtdb.firebaseio.com",
      projectId: "echanj-plus-778cd",
      storageBucket: "echanj-plus-778cd.firebasestorage.app",
      messagingSenderId: "111144762929",
      appId: "1:111144762929:web:e64ce9a6da65781c289f10",
      measurementId: "G-J1BQRF32ZW"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    /* Loader */
    window.addEventListener("load",()=>{document.getElementById("loader").style.display="none";});

    /* Auth */
    let isLogin=true;
    document.getElementById("switch").onclick=()=>{
      isLogin=!isLogin;
      document.getElementById("auth-title").innerText=isLogin?"Login":"Sign Up";
      document.getElementById("auth-action").innerText=isLogin?"Login":"Sign Up";
      document.getElementById("toggle-auth").innerHTML=isLogin?'No account? <a id="switch">Sign Up</a>':'Have account? <a id="switch">Login</a>';
      document.getElementById("switch").onclick=arguments.callee;
    };

    document.getElementById("auth-action").onclick=()=>{
      const email=document.getElementById("email").value;
      const pass=document.getElementById("password").value;
      if(isLogin){
        auth.signInWithEmailAndPassword(email,pass)
        .then(()=>{showToast("Login successful");document.getElementById("auth-screen").style.display="none";})
        .catch(e=>showToast(e.message));
      }else{
        auth.createUserWithEmailAndPassword(email,pass)
        .then(()=>{showToast("Account created");document.getElementById("auth-screen").style.display="none";})
        .catch(e=>showToast(e.message));
      }
    };

    document.getElementById("logout-btn").onclick=()=>{auth.signOut();location.reload();};

    /* Sidebar */
    const sidebar=document.getElementById("sidebar");
    document.getElementById("menu-btn").onclick=()=>{sidebar.classList.toggle("active");};
    let startX=null;
    document.addEventListener("touchstart",e=>{startX=e.touches[0].clientX;});
    document.addEventListener("touchend",e=>{
      let endX=e.changedTouches[0].clientX;
      if(startX<50 && endX>150) sidebar.classList.add("active");
      if(startX>200 && endX<50) sidebar.classList.remove("active");
    });

    /* Navigation */
    document.querySelectorAll("#sidebar a[data-section]").forEach(a=>{
      a.onclick=()=>{
        document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
        document.getElementById(a.dataset.section).classList.add("active");
        sidebar.classList.remove("active");
      };
    });

    /* Dark Mode */
    document.getElementById("toggle-dark").onclick=()=>{document.body.classList.toggle("dark");};

    /* Profile Save */
    document.getElementById("save-profile").onclick=()=>{
      const user=auth.currentUser;
      if(user){
        db.ref("profiles/"+user.uid).set({
          name:document.getElementById("name").value,
          phone:document.getElementById("phone").value,
          gender:document.getElementById("gender").value
        });
        showToast("Profile saved");
      }
    };

    /* Voye Minit */
    document.getElementById("send-minutes").onclick=()=>{
      const amt=parseInt(document.getElementById("amount").value)||0;
      const fee=Math.round(amt*0.175);
      const receive=amt-fee;
      document.getElementById("minutes-result").innerText=`Fr√®: ${fee} gdes | Resevwa: ${receive} gdes`;
    };

    /* Peyman */
    document.getElementById("pay-method").onchange=(e)=>{
      let val=e.target.value;
      let form="";
      if(val==="moncash"||val==="natcash"){
        form=`<input placeholder="Non kont">
              <input placeholder="Nimero kont">
              <input type="number" placeholder="Montan">
              <button>Peye</button>`;
      }
      document.getElementById("pay-form").innerHTML=form;
    };

    /* Feedback */
    document.querySelectorAll("#stars span").forEach(star=>{
      star.onclick=()=>{
        let rate=star.dataset.rate;
        let trust={"1":"10%","2":"30%","3":"50%","4":"75%","5":"100%"}[rate];
        document.getElementById("trust").innerText=`Konfyans: ${trust}`;
        showToast("M√®si pou feedback ou");
      };
    });

    /* Toast */
    function showToast(msg){
      let toast=document.getElementById("toast");
      toast.innerText=msg;
      toast.style.display="block";
      setTimeout(()=>{toast.style.display="none";},3000);
    }
  </script>
</body>
  </html>
