<!DOCTYPE html>
<html lang="ht">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Echanj Plus Dashboard</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; }
body { font-family:'Segoe UI', sans-serif; background:#111; color:#fff; min-height:100vh; overflow-x:hidden; }
header { position:sticky; top:0; display:flex; justify-content:space-between; align-items:center; padding:1rem 1.5rem; background:#1f1f1f; z-index:10; }
.brand h1 { color:#ffc107; font-size:1.8rem; }
.brand p { font-size:0.9rem; color:#ccc; }
.nav-buttons { display:flex; gap:0.5rem; }
.btn { background:#ffc107; color:#000; padding:0.8rem 1.2rem; border:none; border-radius:8px; cursor:pointer; font-weight:600; }
.btn:hover { background:#e0a800; }
.user-area { display:flex; gap:10px; align-items:center; }
.user-badge { background:rgba(255,193,7,0.1); padding:5px 10px; border-radius:20px; font-size:0.8rem; }
section { display:none; max-width:500px; margin:1.5rem auto; padding:2rem; background:#222; border-radius:12px; }
section.active { display:flex; flex-direction:column; }
input, select { width:100%; padding:0.8rem 1rem; margin:0.5rem 0; border-radius:10px; border:1px solid #ffc107; background:#333; color:#fff; }
.inline-group { display:flex; gap:0.5rem; flex-wrap:wrap; }
.auth-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.95); display:flex; align-items:center; justify-content:center; z-index:50; }
.auth-card { background:#1f1f1f; padding:2rem 1.5rem; border-radius:12px; width:90%; max-width:400px; display:flex; flex-direction:column; gap:12px; }
.message { min-height:1.2em; margin-top:6px; font-size:0.9rem; }
.sidebar { position:fixed; top:0; left:-240px; width:240px; height:100%; background:#222; padding:1rem; display:flex; flex-direction:column; gap:12px; transition:0.3s; z-index:30; }
.sidebar.active { left:0; }
.hamburger { font-size:1.5rem; cursor:pointer; }
@media (max-width:600px){ .nav-buttons{ display:none; } }
</style>
</head>
<body>

<header>
  <div class="brand"><h1>Echanj Plus</h1><p>Vit • Senp • Serye</p></div>
  <div class="nav-buttons">
    <button class="btn" onclick="requireAuth(()=>showSection('minit'))">Voye Minit</button>
    <button class="btn" onclick="requireAuth(()=>showSection('peyman'))">Peyman</button>
    <button class="btn" onclick="requireAuth(()=>showSection('profile'))">Profile</button>
  </div>
  <div class="hamburger" onclick="toggleSidebar()">☰</div>
  <div class="user-area" id="userArea" style="display:none;">
    <div class="user-badge" id="userEmailDisplay">...</div>
    <button class="btn" onclick="logout()">Dekonekte</button>
  </div>
</header>

<div class="sidebar" id="sidebar">
  <button class="btn" onclick="showSection('minit')">Voye Minit</button>
  <button class="btn" onclick="showSection('peyman')">Peyman</button>
  <button class="btn" onclick="showSection('profile')">Profile</button>
</div>

<section id="minit">
  <h2>Voye Minit</h2>
  <input type="number" id="minitVal" placeholder="eg: 100" min="100">
  <div class="inline-group">
    <button class="btn" onclick="requireAuth(()=>voyeUSSD('digicel'))">Digicel</button>
    <button class="btn" onclick="requireAuth(()=>voyeUSSD('natcom'))">Natcom</button>
  </div>
</section>

<section id="peyman">
  <h2>Peyman</h2>
  <select id="service">
    <option value="MonCash">MonCash</option>
    <option value="NatCash">NatCash</option>
  </select>
  <input type="text" id="non" placeholder="Non Kont">
  <input type="text" id="numero" placeholder="Nimewo Kont">
  <input type="number" id="montan" placeholder="Montan (min 100)" min="100">
  <button class="btn" onclick="requireAuth(soumetPeyman)">Voye</button>
</section>

<section id="profile">
  <h2>Profile</h2>
  <input type="text" id="profileName" placeholder="Non ou">
  <input type="text" id="profilePhone" placeholder="Nimewo telefòn">
  <select id="profileGender">
    <option value="">Chwazi sèks</option>
    <option value="gason">Gason</option>
    <option value="fi">Fi</option>
  </select>
  <button class="btn" onclick="saveProfile()">Sove Profile</button>
</section>

<div class="auth-overlay" id="authOverlay">
  <div class="auth-card">
    <h2>Konekte oswa Enskri</h2>
    <input type="email" id="email" placeholder="Imèl ou">
    <input type="password" id="password" placeholder="Modpas ou">
    <div class="inline-group">
      <button class="btn" onclick="register()">Enskri</button>
      <button class="btn" onclick="login()">Konekte</button>
    </div>
    <div class="message" id="authMsg"></div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey:"AIzaSyB1VTPakleoggsbLdpm_HS7nSb3A7A99Qw",
  authDomain:"echanj-plus-778cd.firebaseapp.com",
  projectId:"echanj-plus-778cd",
  storageBucket:"echanj-plus-778cd.appspot.com",
  messagingSenderId:"111144762929",
  appId:"1:111144762929:web:e64ce9a6da65781c289f10",
  databaseURL:"https://echanj-plus-778cd-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const auth=firebase.auth();

const authOverlay=document.getElementById('authOverlay');
const userArea=document.getElementById('userArea');
const userEmailDisplay=document.getElementById('userEmailDisplay');
const authMsg=document.getElementById('authMsg');
const sidebar=document.getElementById('sidebar');

function showSection(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  sidebar.classList.remove('active');
}

function requireAuth(fn){
  if(auth.currentUser) fn();
  else showAuth('Tanpri konekte pou kontinye.');
}

function showAuth(msg){
  authOverlay.style.display='flex';
  if(msg){ authMsg.textContent=msg; authMsg.style.color='#ffcc00'; }
}

function hideAuth(){ authOverlay.style.display='none'; }

function register(){
  const email=document.getElementById('email').value.trim();
  const password=document.getElementById('password').value.trim();
  if(!email||!password){ authMsg.textContent='Ranpli tout chan yo'; authMsg.style.color='red'; return; }
  auth.createUserWithEmailAndPassword(email,password)
    .then(u=>{ authMsg.textContent='Enskripsyon siksè!'; authMsg.style.color='lightgreen'; hideAuth(); })
    .catch(e=>{ authMsg.textContent=e.message; authMsg.style.color='red'; });
}

function login(){
  const email=document.getElementById('email').value.trim();
  const password=document.getElementById('password').value.trim();
  if(!email||!password){ authMsg.textContent='Ranpli tout chan yo'; authMsg.style.color='red'; return; }
  auth.signInWithEmailAndPassword(email,password)
    .then(u=>{ authMsg.textContent='Byenvini!'; authMsg.style.color='lightgreen'; hideAuth(); showSection('minit'); loadProfile(); })
    .catch(e=>{ authMsg.textContent=e.message; authMsg.style.color='red'; });
}

function logout(){
  auth.signOut().then(()=>{ userArea.style.display='none'; showAuth(); });
}

auth.onAuthStateChanged(user=>{
  if(user){ userArea.style.display='flex'; userEmailDisplay.textContent=user.email; hideAuth(); showSection('minit'); loadProfile(); }
  else showAuth();
});

function voyeUSSD(type){
  const minit=document.getElementById('minitVal').value;
  if(!minit||minit<100){ alert('Mete omwen 100'); return; }
  let ussd='';
  if(type==='digicel') ussd=`tel:*128*50947111123*${minit}#`;
  if(type==='natcom') ussd=`tel:*123*88888888*32160708*${minit}#`;
  window.location.href=ussd;
}

function soumetPeyman(){
  const nom=document.getElementById('non').value;
  const numero=document.getElementById('numero').value;
  const montan=parseInt(document.getElementById('montan').value);
  const service=document.getElementById('service').value;
  if(!nom||!numero||montan<100){ alert('Ranpli tout chan yo epi mete plis pase 100'); return; }
  const frais=Math.round(montan*0.175);
  const kod='EP'+Date.now();
  const done={ non:nom, telephone:numero, montan, frais, date:new Date().toLocaleString(), code:kod };
  db.ref('transactions/'+kod).set(done);
  const mesaj=`EchanjPlus\nNon:${nom}\nNimewo:${numero}\nMontan:${montan} G\nFrais:${frais} G\nSèvis:${service}\nKod:${kod}`;
  window.open(`https://wa.me/50947111123?text=${encodeURIComponent(mesaj)}`);
}

function saveProfile(){
  const name=document.getElementById('profileName').value.trim();
  const phone=document.getElementById('profilePhone').value.trim();
  const gender=document.getElementById('profileGender').value;
  if(!name||!phone||!gender){ alert('Ranpli tout chan profile'); return; }
  const uid=auth.currentUser.uid;
  db.ref('users/'+uid).set({name, phone, gender});
  alert('Profile sove!');
}

function loadProfile(){
  const uid=auth.currentUser.uid;
  db.ref('users/'+uid).get().then(snapshot=>{
    if(snapshot.exists()){
      const data=snapshot.val();
      document.getElementById('profileName').value=data.name||'';
      document.getElementById('profilePhone').value=data.phone||'';
      document.getElementById('profileGender').value=data.gender||'';
    }
  });
}

function toggleSidebar(){ sidebar.classList.toggle('active'); }

let touchStartX=0;
document.body.addEventListener('touchstart', e=>{ touchStartX=e.touches[0].clientX; });
document.body.addEventListener('touchend', e=>{
  const touchEndX=e.changedTouches[0].clientX;
  if(touchEndX-touchStartX>50) sidebar.classList.add('active');
  if(touchStartX-touchEndX>50) sidebar.classList.remove('active');
});
</script>
</body>
</html>
